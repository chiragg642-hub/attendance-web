<!DOCTYPE html>
<html>
<head>
  <title>Mark Attendance</title>
</head>
<body>

<h2>Student Attendance</h2>

<input id="roll" placeholder="Roll Number" />
<input id="name" placeholder="Full Name" />

<button onclick="submitAttendance()">Submit</button>

<p id="msg"></p>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwlx06JsnHTFGWO8pD5pisrtNZrSgu_DQk7L4qeZ5lpdUmC4Ev8oBZzSQ6xvbQBqAhZkg/exec";

const params = new URLSearchParams(window.location.search);
const SESSION_ID = params.get("session");

if (!SESSION_ID) {
  document.getElementById("msg").innerText = "Invalid session link";
}

function submitAttendance() {
  const roll = rollEl.value.trim();
  const name = nameEl.value.trim();

  if (!roll || !name) {
    msg.innerText = "Fill all fields";
    return;
  }

  msg.innerText = "Submitting...";

  fetch(WEB_APP_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      session_id: SESSION_ID,
      roll: roll,
      name: name
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") msg.innerText = "Attendance marked ✅";
    else if (data.status === "duplicate") msg.innerText = "Already marked ⚠️";
    else if (data.status === "expired") msg.innerText = "Session closed ⏱️";
    else msg.innerText = data.message || "Error ❌";
  })
  .catch(() => msg.innerText = "Network error ❌");
}

const rollEl = document.getElementById("roll");
const nameEl = document.getElementById("name");
const msg = document.getElementById("msg");
</script>

</body>
</html>
